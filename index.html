<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <title>Mini Hill Climb</title>
</head>
<body>
  <canvas id="c"></canvas>

  <!-- Overlays (Menu / Game Over) are created by game.js (existing approach) -->

  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
  <script src="game.js"></script>

  <script>
    // Stable SW registration (no version query needed).
    // This SW is designed so you can update game.js/assets without touching sw.js again.
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        try {
          const reg = await navigator.serviceWorker.register("./sw.js", { scope: "./" });

          // Ask SW to activate immediately if waiting
          if (reg.waiting) reg.waiting.postMessage({ type: "SKIP_WAITING" });

          // Proactively check for SW updates (rare; only when sw.js itself changes)
          reg.update().catch(()=>{});

          // If a new SW takes control, reload once
          let reloaded = false;
          navigator.serviceWorker.addEventListener("controllerchange", () => {
            if (reloaded) return;
            reloaded = true;
            window.location.reload();
          });

          // Also poll update (harmless)
          setInterval(() => { try { reg.update(); } catch(e){} }, 60000);
        } catch (e) {
          // If SW fails, the game still loads online.
          console.warn("SW register failed", e);
        }
      });
    }
  </script>
</body>
</html>
